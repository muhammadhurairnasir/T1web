<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products - BESAFARI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    .product-card {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      height: 100%;
      transition: transform 0.2s;
    }
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .product-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    .product-price {
      font-size: 24px;
      font-weight: bold;
      color: turquoise;
    }
    .filter-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
  </style>
</head>

<body class="wildlife-page">

  <!-- Header Section -->
  <div class="hero-section">
    <header class="d-flex justify-content-between align-items-center px-4">
      <div class="logo">
        <img src="/images/safarilogo.png" alt="SAFARI">
      </div>
      <nav>
        <ul class="nav-list">
          <li><a href="/">START</a></li>
          <li><a href="/#section2">MUST VISIT</a></li>
          <li><a href="/wildlife">PRODUCTS</a></li>
          <li><a href="/#section4">TOURS</a></li>
          <li><a href="/#section5">CONTACT</a></li>
          <li><a href="/checkout">BUY NOW</a></li>
        </ul>
      </nav>
    </header>
    <h1>Our Products</h1>
  </div>

  <!-- Content Section -->
  <div class="content-section">
    <div class="container">

      <!-- Error Message -->
      <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger" role="alert">
          <%= error %>
        </div>
      <% } %>

      <!-- Filters Section -->
      <div class="filter-section">
        <h3>Filters</h3>
        <form method="GET" action="/wildlife" class="row g-3">
          <div class="col-md-3">
            <label class="form-label">Category</label>
            <select name="category" class="form-select">
              <option value="all" <%= filters.category === 'all' ? 'selected' : '' %>>All Categories</option>
              <% categories.forEach(function(cat) { %>
                <option value="<%= cat %>" <%= filters.category === cat ? 'selected' : '' %>><%= cat %></option>
              <% }); %>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Min Price ($)</label>
            <input type="number" name="minPrice" class="form-control" value="<%= filters.minPrice %>" min="0" step="0.01">
          </div>
          <div class="col-md-3">
            <label class="form-label">Max Price ($)</label>
            <input type="number" name="maxPrice" class="form-control" value="<%= filters.maxPrice %>" min="0" step="0.01">
          </div>
          <div class="col-md-3">
            <label class="form-label">&nbsp;</label>
            <div>
              <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
              <a href="/wildlife" class="btn btn-secondary w-100 mt-2">Clear</a>
            </div>
          </div>
          <input type="hidden" name="page" value="1">
          <input type="hidden" name="limit" value="<%= limit %>">
        </form>
      </div>

      <!-- Products Grid -->
      <div class="row">
        <% if (products && products.length > 0) { %>
          <% products.forEach(function(product) { %>
            <div class="col-md-4 col-sm-6">
              <div class="product-card">
                <img src="<%= product.image %>" alt="<%= product.name %>" class="product-image">
                <h5><%= product.name %></h5>
                <p class="text-muted"><%= product.description %></p>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="product-price">$<%= product.price.toFixed(2) %></span>
                  <span class="badge bg-secondary"><%= product.category %></span>
                </div>
                <div class="mt-3 d-flex flex-column gap-2">
                  <button class="btn btn-warning btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#edit-<%= product.id || product._id %>">
                    Edit
                  </button>
                  <a href="/wildlife/delete/<%= product.id || product._id %>" 
                     class="btn btn-danger btn-sm" 
                     onclick="return confirm('Are you sure you want to delete this product?')">Delete</a>
                  <div class="collapse mt-2" id="edit-<%= product.id || product._id %>">
                    <form action="/wildlife/update/<%= product.id || product._id %>" method="POST" class="border rounded p-2">
                      <div class="mb-2">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control form-control-sm" name="name" value="<%= product.name %>" required>
                      </div>
                      <div class="mb-2">
                        <label class="form-label">Price ($)</label>
                        <input type="number" class="form-control form-control-sm" name="price" step="0.01" min="0" value="<%= product.price %>" required>
                      </div>
                      <div class="mb-2">
                        <label class="form-label">Category</label>
                        <input type="text" class="form-control form-control-sm" name="category" value="<%= product.category %>" required>
                      </div>
                      <div class="mb-2">
                        <label class="form-label">Image URL</label>
                        <input type="text" class="form-control form-control-sm" name="image" value="<%= product.image %>">
                      </div>
                      <div class="mb-2">
                        <label class="form-label">Description</label>
                        <textarea class="form-control form-control-sm" name="description" rows="2" required><%= product.description %></textarea>
                      </div>
                      <div class="d-flex justify-content-end gap-2">
                        <button type="submit" class="btn btn-primary btn-sm">Update</button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-toggle="collapse" data-bs-target="#edit-<%= product.id || product._id %>">Cancel</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <div class="col-12">
            <div class="alert alert-info text-center">
              No products found. <% if (categories.length === 0) { %>Add products using the form below!<% } else { %>Try adjusting your filters.<% } %>
            </div>
          </div>
        <% } %>
      </div>

      <!-- Pagination -->
      <% if (totalPages > 1) { %>
        <nav aria-label="Page navigation" class="mt-4">
          <ul class="pagination justify-content-center">
            <% if (currentPage > 1) { %>
              <li class="page-item">
                <a class="page-link" href="/wildlife?page=<%= currentPage - 1 %>&limit=<%= limit %><%= filters.category !== 'all' ? '&category=' + filters.category : '' %><%= filters.minPrice ? '&minPrice=' + filters.minPrice : '' %><%= filters.maxPrice ? '&maxPrice=' + filters.maxPrice : '' %>">Previous</a>
              </li>
            <% } %>
            
            <% for (let i = 1; i <= totalPages; i++) { %>
              <% if (i === currentPage) { %>
                <li class="page-item active">
                  <span class="page-link"><%= i %></span>
                </li>
              <% } else { %>
                <li class="page-item">
                  <a class="page-link" href="/wildlife?page=<%= i %>&limit=<%= limit %><%= filters.category !== 'all' ? '&category=' + filters.category : '' %><%= filters.minPrice ? '&minPrice=' + filters.minPrice : '' %><%= filters.maxPrice ? '&maxPrice=' + filters.maxPrice : '' %>"><%= i %></a>
                </li>
              <% } %>
            <% } %>
            
            <% if (currentPage < totalPages) { %>
              <li class="page-item">
                <a class="page-link" href="/wildlife?page=<%= currentPage + 1 %>&limit=<%= limit %><%= filters.category !== 'all' ? '&category=' + filters.category : '' %><%= filters.minPrice ? '&minPrice=' + filters.minPrice : '' %><%= filters.maxPrice ? '&maxPrice=' + filters.maxPrice : '' %>">Next</a>
              </li>
            <% } %>
          </ul>
        </nav>
        <p class="text-center text-muted mt-2">
          Showing <%= (currentPage - 1) * limit + 1 %>-<%= Math.min(currentPage * limit, totalProducts) %> of <%= totalProducts %> products
        </p>
      <% } %>

      <hr>

      <!-- Add New Product Form -->
      <div class="row mb-4">
        <div class="col-md-12">
          <h2>Add New Product</h2>
          <form action="/wildlife/add" method="POST">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="name" class="form-label">Product Name:</label>
                  <input type="text" class="form-control" id="name" name="name" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="price" class="form-label">Price ($):</label>
                  <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="category" class="form-label">Category:</label>
                  <input type="text" class="form-control" id="category" name="category" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="image" class="form-label">Image URL:</label>
                  <input type="text" class="form-control" id="image" name="image" placeholder="/images/square.png">
                </div>
              </div>
              <div class="col-md-12">
                <div class="mb-3">
                  <label for="description" class="form-label">Description:</label>
                  <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
                </div>
              </div>
            </div>
            <button type="submit" class="btn btn-primary me-2">Create Product</button>
            <button type="reset" class="btn btn-secondary">Clear</button>
          </form>
        </div>
      </div>

    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>Â© 2025 BESAFARI. All Rights Reserved.</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
